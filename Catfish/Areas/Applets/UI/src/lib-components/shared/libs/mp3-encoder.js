import{lamejs}from"./lame.all";export default class{constructor(t){this.bitRate=t.bitRate,this.sampleRate=t.sampleRate,this.dataBuffer=[],this.encoder=new lamejs.Mp3Encoder(1,this.sampleRate,this.bitRate)}encode(t){const e=this._convertBuffer(t);let a=e.length;for(let t=0;a>=0;t+=1152){const r=e.subarray(t,t+1152),s=this.encoder.encodeBuffer(r);this.dataBuffer.push(new Int8Array(s)),a-=1152}}finish(){this.dataBuffer.push(this.encoder.flush());const t=new Blob(this.dataBuffer,{type:"audio/mp3"});return this.dataBuffer=[],{id:Date.now(),blob:t,url:URL.createObjectURL(t)}}_floatTo16BitPCM(t,e){for(let a=0;a<t.length;a++){const r=Math.max(-1,Math.min(1,t[a]));e[a]=r<0?32768*r:32767*r}}_convertBuffer(t){const e=new Float32Array(t),a=new Int16Array(t.length);return this._floatTo16BitPCM(e,a),a}}
