@model Catfish.Areas.Manager.Pages.FieldContainerPageModel
@inject Piranha.Manager.ManagerLocalizer Localizer
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div id="edit-field-form-page">
    <div class="top">
        <div class="container-fluid top">
            <div class="left-nav-container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">@Localizer.Menu["Templates"]</li>
                        <li class="breadcrumb-item">@Localizer.Menu[Model.ModelLabel]</li>
                        <li class="breadcrumb-item">@Localizer.Menu["Edit"]</li>
                        <li class="breadcrumb-item active" aria-current="page">@Localizer.Menu[Model.Model.Id.ToString()]</li>
                    </ol>
                </nav>
            </div>

            <div class="container-fluid collection-button-holder">
                <div class="top-nav"> SOME BUTTON
                    @*@foreach (var action in Catfish.Areas.Manager.Actions.Toolbars.FormList)
                    {
                        <partial name="@action.ActionView" />
                    }*@
                </div>
            </div>
        </div>
    </div>

    @{ var url = Model.ApiRoot + Model.Model.Id.ToString();}
    <a href="@url" target="_blank">See JSON Object</a>

    <form v-if="finishedGET">
        <div class="form-group flex-full">
            <label for="form-title">Title</label>
            <div v-for="(name, titleIndex) of names.values">
            <input type="text" class="form-title form-control" :value="name.value" 
                :id="'form-title-' + titleIndex" placeholder="Title Your Form Here" />
            </div>

            <label for="form-description">Description</label>
            <div v-for="(description, descriptionIndex) of descriptions.values">
                <textarea type="text" class="form-description form-control" 
                :id="'form-description-' + descriptionIndex"
                placeholder="Description goes here">
                {{description.value}}
                </textarea>
            </div>

            <hr />

            <label for="">Fields</label>
            <div class="container-fluid" style="display:flex; flex-direction:row;">
                <draggable class="flex-full col-10" v-model="fields" group="sharedItems" handle=".handle-drag">
                    <div v-for="(field, fieldIndex) of fields" class="card field-card-width" :key='fieldIndex'>
                    <!-- Editable fields -->
                        <div style="display:flex;">

                            <div class="handle-drag draggable">
                                <i class="fas fa-grip-vertical"></i>
                            </div>

                            <div class="field-card-contents">
                                <div class="sitemap-item card-header">
                                    <a v-on:click="toggleDropdown(field.id)" class="handle-holder" data-toggle="collapse" :href="['#collapse-' + fieldIndex ]">
                                        <div class="handle">
                                            <i :class="{ 'fas fa-chevron-down': !dropdowns[field.id].isCollapsed, 'fas fa-chevron-right': dropdowns[field.id].isCollapsed}"></i>
                                        </div>
                                    </a>
                                    <div v-if="field.$type" class="title-header">
                                        <div v-if="field.name.values[0].value.length == 0">
                                            <h2><i>Field Title</i></h2>
                                        </div>
                                        <h2 v-else>{{field.name.values[0].value}}</h2>
                                        <!-- Remove the hardcodiness of this when api data is used -->
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.TextField, Catfish.Core' ">Short Answer</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.TextArea, Catfish.Core' ">Long Answer</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Radio, Catfish.Core' ">Multiple Choice</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Checkbox, Catfish.Core' ">Checkbox</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Dropdown, Catfish.Core' ">Dropdown</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.FileAttachment, Catfish.Core' ">File Upload</h5>
                                        <h5 v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.DisplayField, Catfish.Core' ">Display Text</h5>
                                    </div>
                                    <div v-else class="title-header">
                                        <h5>Default Item - Fix Me</h5>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" :value="field.required" 
                                        :id="'required-checkbox-' + fieldIndex">
                                        <label class="form-check-label" :for="'required-checkbox-' + fieldIndex">
                                            <h2 style="color:red;"><b>*</b></h2>
                                        </label>
                                    </div>
                                </div>

                                <div :id="['collapse-' + fieldIndex ]" class="collapse-expand show border-top">
                                    <div class="card-header" style="text-transform:none;padding-bottom: 0;">
                                        <h4>
                                            Field Title
                                        </h4>
                            
                                        <!--<button type="button" class="btn btn-secondary rounded" data-toggle="popover"
                                            data-content="This is the title of the question you want to ask.">
                                            <i class="fas fa-info"></i>
                                        </button>-->
                                    </div>


                                    <ul v-for="nameValue of field.name.values" class="list-group list-group-flush">
                                        <li class="list-group-item flex-li">
                                            <label class="field-item-label">{{nameValue.language}}</label>
                                            <input type="text" class="field-input form-control" v-model="nameValue.value" 
                                            :id="'field-title-' + fieldIndex + '-' + nameValue" 
                                            placeholder="Title Your Field Here" />
                                        </li>
                                    </ul>

                                    <div class="card-header" style="text-transform:none;padding-bottom: 0;">
                                        <h4>
                                            Description
                                        </h4>
                            
                                        <!--<button type="button" class="btn btn-secondary rounded" data-toggle="popover"
                                            data-content="This should provide more detail about what you want to ask. Optional.">
                                            <i class="fas fa-info"></i>
                                        </button>-->
                                    </div>

                                    <ul v-for="descriptionValue of field.description.values" class="list-group list-group-flush">
                                        <li class="list-group-item flex-li">
                                            <label class="field-item-label">{{descriptionValue.language}}</label>
                                            <textarea type="text" class="field-input form-control" 
                                            :id="'field-description-' + fieldIndex + '-' + descriptionValue" 
                                            placeholder="Describe the purpose of this field..."
                                            v-model="descriptionValue.value">
                                            </textarea>
                                        </li>
                                    </ul>

                                    <div v-if="(field.$type != 'Catfish.Core.Models.Contents.Fields.TextField, Catfish.Core') && field.$type != 'Catfish.Core.Models.Contents.Fields.TextArea, Catfish.Core'" >
                                        <div class="card-header" style="text-transform:none;">
                                            <h4>
                                                Appearance
                                            </h4>
                                            <div style="padding: .75rem 1.25rem;">
                                                <!-- Short Answer 
                                                <input v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.TextField, Catfish.Core' "
                                                    class="form-control" readonly placeholder="Short answer"/>-->
                                                <!-- Long Answer 
                                                <div v-else-if="field.$type == 'Catfish.Core.Models.Contents.Fields.TextArea, Catfish.Core' ">
                                                    <quill-editor disabled :ref="'richtext' + fieldIndex">
                                                    </quill-editor>
                                                </div>-->
                                                <!-- Radio -->
                                                <div v-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Radio, Catfish.Core' ">
                                                    <div v-for="(radioValue, radioIndex) of field.values" class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">
                                                                <input disabled :id="'radio-' + radioIndex" :name="'radio-field-' + fieldIndex" type="radio" aria-label="Radio button for following text input">
                                                            </div>
                                                        </div>
                                                        <input type="text" class="form-control" :disabled="radioValue.isDisabled" aria-label="Text input with radio button and remove button" v-model="radioValue.text">
                                                        <div class="input-group-append">
                                                            <button class="btn btn-outline-secondary" v-on:click="removeOption(fieldIndex, radioIndex)" type="button">-</button>
                                                        </div>
                                                    </div>
                                                    <div class="add-button-holder">
                                                        <button v-on:click="addOtherOption(field)" type="button" class="btn btn-secondary rounded">Add Blank</button>
                                                        <button v-on:click="addNewOption(field)" type="button" class="btn btn-secondary rounded">Add</button>
                                                    </div>
                                                </div>
                                                <!-- Checkbox -->
                                                <div v-else-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Checkbox, Catfish.Core'">
                                                    <div v-for="(checkValue, checkIndex) of field.values" class="input-group mb-3">
                                                        <div class="input-group-prepend">
                                                            <div class="input-group-text">
                                                                <input :id="'checkbox-' + checkIndex" :disabled="checkValue.isDisabled" :name="'check-field-' + fieldIndex" type="checkbox" aria-label="Checkbox for following text input">
                                                            </div>
                                                        </div>
                                                        <input type="text" class="form-control" aria-label="Text input with checkbox and remove button" v-model="checkValue.text">
                                                        <div class="input-group-append">
                                                            <button class="btn btn-outline-secondary" v-on:click="removeOption(fieldIndex, checkIndex)" type="button">-</button>
                                                        </div>
                                                    </div>
                                                    <div class="add-button-holder">
                                                        <button v-on:click="addOtherOption(field)" type="button" class="btn btn-secondary rounded">Add Blank</button>
                                                        <button v-on:click="addNewOption(field)" type="button" class="btn btn-secondary rounded">Add</button>
                                                    </div>                                               
                                                </div>
                                                <!-- Dropdown -->
                                                <div v-else-if="field.$type == 'Catfish.Core.Models.Contents.Fields.Dropdown, Catfish.Core'">
                                                    <div v-for="(dropdownValue, dropdownIndex) of field.values" class="input-group mb-3">
                                                        <input type="text" class="form-control" aria-label="Text input with remove button" v-model="dropdownValue.text">
                                                        <div class="input-group-append">
                                                            <button class="btn btn-outline-secondary" v-on:click="removeOption(fieldIndex, dropdownIndex)" type="button">-</button>
                                                        </div>
                                                    </div>
                                                    <button v-on:click="addNewOption(field)" type="button" class="btn btn-secondary rounded">+</button>
                                                </div>
                                                <!-- File attachment -->
                                                <div v-else-if="field.$type == 'Catfish.Core.Models.Contents.Fields.FileAttachment, Catfish.Core'">
                                                    <div class="file-attachment-box">
                                                        <button disabled class="btn btn-outline-secondary">Upload Your Files Here</button>
                                                    </div>
                                                </div>
                                                <!--Display text -->
                                                <div v-else-if="field.$type == 'Catfish.Core.Models.Contents.Fields.DisplayField, Catfish.Core' ">
                                                    <quill-editor :ref="'richtext' + fieldIndex">
                                                    </quill-editor>
                                                </div>

                                            </div>
                                        </div>
                                     
                                    </div>
                                    <div class="card-footer field-bottom">
                                        <b-form-group class="field-dropdown" :id="'fieldset-' + fieldIndex" :label-for="'field-dropdown-' + fieldIndex"> <!-- :invalid-feedback="invalidPublishFeedback" :class="{ 'form-group--error': $v.publishedStatus.$error }" -->
			                                <b-form-select :id="'field-dropdown-' + fieldIndex" :options='fieldTypes' v-model="field.selected"> <!-- v-model.trim="$v.publishedStatus.$model" :state="validateState('publishedStatus')" -->
                                            </b-form-select>
                                        </b-form-group>
                                        
                                        <b-button variant="danger">
                                            <i class="fas fa-trash"></i>
                                        </b-button>
                                    </div>
                                </div>
                            </div>
                    
                        </div>

                    </div>
                </draggable>

                <div class="col-2 fieldtypes-holder">
                    <div class="card fieldtype-draggable">
                        <div class="card-header" style="text-transform:none;">Add Question</div>
                        <div class="card-header" style="text-transform:none;">Add Section(TBA)</div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div v-else>Put loading something or other here</div>

</div>