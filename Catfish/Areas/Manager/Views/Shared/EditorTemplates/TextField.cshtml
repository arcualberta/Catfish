@model Catfish.Core.Models.Forms.TextField

@Html.Hidden("ModelType", Model.GetType().AssemblyQualifiedName, new Dictionary<string, object>()
{
    {"class", "model-type"}
})

@{
    List<Catfish.Core.Models.TextValue> emptyValues = new List<Catfish.Core.Models.TextValue>();
   
    foreach (var l in Model.MultilingualName) 
    {
        emptyValues.Add(new Catfish.Core.Models.TextValue(l.LanguageCode, l.LanguageLabel, string.Empty));
    }

    ViewBag.NumLangs = Model.MultilingualName.Count();


}
@Html.HiddenFor(m => m.Guid)


<div class="form-field-name">
    @Html.Label(string.IsNullOrEmpty(Model.Name) ? "" : Model.Name, new { @name = "label" })
</div>
<div class="form-field-value">
    @{ bool showLanguageLabel = Model.Values.Count() > 1;
        int countLangGrp = Model.Values.Count() / Model.MultilingualName.Count(); //number of languages set
        string langGrpId = "langGrp_" + countLangGrp;
        int langCount = Model.MultilingualName.Count();

        //wrap lang group in a div
       
    }

            @Html.EditorFor(m => m.Values, new { ShowLanguageLabel = showLanguageLabel })
            @Html.HiddenFor(m => m.IsMultiple)
            @{
                if (Model.IsMultiple)
                {
                    var elName = "'" + Html.NameFor(m => m.Values) + "'";
                    <div id="addTextFieldEntry"><button id="ButtonTextFieldAddEntry" onclick="AddField(); return false;">Add Entry</button></div>
                }
            }
        </div>

<script type="text/javascript">


    function removeSection(secId)
    {
    alert("remove " + secId);
       $("#" + secId).remove();
    }
    var countClick=1;
    function AddField()
    {
      let elName = '@Html.Raw(Html.NameFor(m => m.Values))';
      var langs =  @Html.Raw(Json.Encode(Model.MultilingualName.ToArray()));

       var uniqueIndex= @countLangGrp * @langCount * countClick;
       let elGrpId ="langGrp_" + ( @countLangGrp +countClick);
       var elToAdd='<div id="'+ elGrpId +'" class="elementLangGroup">';

       for(var i=0; i<@langCount; i++)
       {

         elToAdd = elToAdd + '<hidden name="' + elName +'.Index" value="' + uniqueIndex + '"></hidden>' +
                      '<input class="model-type"  name="' + elName + '[' + uniqueIndex +'].ModelType" type="hidden" value="Catfish.Core.Models.TextValue, Catfish.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null">'+
                      '<input  name="' + elName + '[' + uniqueIndex +'].LanguageCode" type="hidden" value="' + langs[i].LanguageCode + '">' +
                     '<div class="languageInputField">' +
                        '<span class="lang-label">' + langs[i].LanguageLabel +': </span>' +
                        '<input class="text-box single-line" name="' + elName + '[' + uniqueIndex + '].Value" type="text" value=""></div>';
         uniqueIndex++;
      }
      elToAdd= elToAdd +'<span class="glyphicon glyphicon-remove removeLangGroup" onclick="removeSection(\''+ elGrpId + '\'); return false;" ></span></div>';
     $("#addTextFieldEntry").before(elToAdd);
     countClick++;

    }

</script>
<style>
    .elementLangGroup {
        border: 1px solid lightgrey;
        width:50%;
    }
    .removeLangGroup{
        float:right;
        margin-top: -50px;
    }
</style>