@model Catfish.Areas.Manager.Models.ViewModels.EntityTypeViewModel
@using PerpetuumSoft.Knockout
@using Catfish.Areas.Manager.Models.ViewModels
@using Catfish.Core.Models

@{  ViewBag.Title = Model.Id > 0 ? "Edit Entity Type" : "Create Entity Type"; }

@section HEAD
{
    <script type="text/javascript" src="~/Scripts/knockout-3.1.0.js"></script>
    <script type="text/javascript" src="~/Scripts/knockout.mapping-latest.js"></script>
    <script type="text/javascript" src="~/Scripts/perpetuum.knockout.js"></script>
}

@section Toolbar {
    @Html.Partial("Partial/koEditToolbar")
}

@{
    var context = "ctx_" + Guid.NewGuid().ToString("N");
    var ko = Html.CreateKnockoutContext(context);
}

<div id="@context">
    @using (ko.Html.Form("Save", "EntityTypes", null, new { id = context + "Form" }))
    {
        <div class="grid_12">
            <div class="box">
                <div class="title">
                    Basic Information
                    <div class="bs right">
                        <span @ko.Bind.Visible(m => m.Status == KoBaseViewModel.eStatus.Success) style="display: none;" class="alert alert-success">Success!</span>
                        <span @ko.Bind.Visible(m => m.Status == KoBaseViewModel.eStatus.Error) style="display: none;" class="alert alert-danger">Error!</span>
                        @ko.Html.Button("Save", "Save", "EntityTypes")
                    </div>
                </div>
                <div class="inner">
                    <ul class="form form-custom">
                        <li>
                            <label class="control-label col-md-2">Name</label>
                            <div class="input">@ko.Html.TextBox(m => m.Name)</div>
                        </li>
                        <li>
                            <label class="control-label col-md-2">Description</label>
                            <div class="input">@ko.Html.TextArea(m => m.Description)</div>
                        </li>
                        <li>
                            <label class="control-label col-md-2">Applicability</label>
                            <div class="input">
                                @ko.Html.RadioButton(m => m.TargetType, new { value = EntityType.eTarget.Collections.ToString() }) Collections
                                @ko.Html.RadioButton(m => m.TargetType, new { value = EntityType.eTarget.Items.ToString() }) Items
                                @ko.Html.RadioButton(m => m.TargetType, new { value = EntityType.eTarget.Files.ToString() }) Files
                            </div>
                        </li>

                    </ul>
                </div>
            </div>

            <div id="fields-container">
                <div class="box">
                    <div class="title">
                        Metadata Sets
                        <div class="right">
                            @ko.Html.DropDownList(m => m.AvailableMetadataSets, new { }, m => m.Name).Value(m => m.SelectedMetadataSets)
                            @ko.Html.Button("Add Metadata Set", "AddMetadataSet", "EntityTypes", new { }, new { }).Enable(m => m.SelectedMetadataSets != null && m.SelectedMetadataSets.Name != null)
                        </div>
                    </div>
                    @using (var ms = ko.Foreach(m => m.AssociatedMetadataSets))
                    {
                        <div class="bs">
                            <div class="right slip-button-panel">
                                @ko.Html.Button("", "Move", "EntityTypes", new { idx = @ms.GetIndex(), step = -1 }, new { @class = "glyphicon glyphicon glyphicon-arrow-up" })
                                @ko.Html.Button("", "Move", "EntityTypes", new { idx = @ms.GetIndex(), step = 1 }, new { @class = "glyphicon glyphicon glyphicon-arrow-down" })
                                @ko.Html.Button("", "RemoveMetadataSet", "EntityTypes", new { idx = @ms.GetIndex() }, new { @class = "glyphicon glyphicon-remove" })
                            </div>
                        </div>
                        <div class="inner">
                            @ms.Html.Span(m => m.Name)
                        </div>
                    }
              </div>
            </div>

            <div id="fields-container">
                <div class="box">
                    <div class="title">
                        Field Mappings
                    </div>
                    <div class="inner">
                        <div class="box">
                            <div class="title">
                                Name Mapping
                            </div>
                            <div class="bs">
                                <div class="inner">
                                    <ul class="form form-custom">
                                        <li>
                                            <label class="control-label col-md-2">Metadata Set</label>
                                            <div class="right">
                                                @ko.Html.DropDownList(m => m.MetadataSetMappingSrc, new { }, m => m.Name).Value(m => m.SelectedNameMappingMetadataSet)
                                                @ko.Html.Button("Update", "UpdateMappingMetadataSet", "EntityTypes", new { type = EntityTypeViewModel.eMappingType.NameMapping }, new { }).Enable(m => m.SelectedNameMappingMetadataSet != null && m.SelectedNameMappingMetadataSet.Name != null && m.SelectedNameMappingMetadataSet.Name != "")
                                            </div>
                                            <div class="input">
                                                @using (var mapping = ko.With(m => m.NameMapping))
                                                {
                                                    @ko.Html.Span(m => mapping.Model.MetadataSet)
                                                }
                                            </div>
                                        </li>
                                        <li>
                                            <label class="control-label col-md-2">Field</label>
                                            <div class="right">
                                                @ko.Html.DropDownList(m => m.SelectedNameMappingFieldSrc, new { }, m => m).Value(m => m.SelectedNameMappingField)
                                                @ko.Html.Button("Update", "UpdateMappingField", "EntityTypes", new { type = EntityTypeViewModel.eMappingType.NameMapping }, new { }).Enable(m => m.SelectedNameMappingField != null && m.SelectedNameMappingField != "")
                                            </div>
                                            <div class="input">
                                                @using (var mapping = ko.With(m => m.NameMapping))
                                                {
                                                    @ko.Html.Span(m => mapping.Model.Field)
                                                }
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="inner">
                        <div class="box">
                            <div class="title">
                                Description Mapping
                            </div>
                            <div class="bs">
                                <div class="inner">
                                    <ul class="form form-custom">
                                        <li>
                                            <label class="control-label col-md-2">Metadata Set</label>
                                            <div class="right">
                                                @ko.Html.DropDownList(m => m.MetadataSetMappingSrc, new { }, m => m.Name).Value(m => m.SelectedDescriptionMappingMetadataSet)
                                                @ko.Html.Button("Update", "UpdateMappingMetadataSet", "EntityTypes", new { type = EntityTypeViewModel.eMappingType.DescriptionMapping }, new { }).Enable(m => m.SelectedDescriptionMappingMetadataSet != null && m.SelectedDescriptionMappingMetadataSet.Name != null && m.SelectedDescriptionMappingMetadataSet.Name != "")
                                            </div>
                                            <div class="input">
                                                @using (var mapping = ko.With(m => m.DescriptionMapping))
                                                {
                                                    @ko.Html.Span(m => mapping.Model.MetadataSet)
                                                }
                                            </div>
                                        </li>
                                        <li>
                                            <label class="control-label col-md-2">Field</label>
                                            <div class="right">
                                                @ko.Html.DropDownList(m => m.SelectedDescriptionMappingFieldSrc, new { }, m => m).Value(m => m.SelectedDescriptionMappingField)
                                                @ko.Html.Button("Update", "UpdateMappingField", "EntityTypes", new { type = EntityTypeViewModel.eMappingType.DescriptionMapping }, new { }).Enable(m => m.SelectedDescriptionMappingField != null && m.SelectedDescriptionMappingField != "")
                                            </div>
                                            <div class="input">
                                                @using (var mapping = ko.With(m => m.DescriptionMapping))
                                                {
                                                    @ko.Html.Span(m => mapping.Model.Field)
                                                }
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
     @*<div id="fields-container">
                <div class="box">
                    <div class="title">
                        Field Mappings
                    </div>
                    <div class="inner">
                        <div id="fields-container">
                            <div class="box">
                                <div class="title">
                                    Name Mapping
                                    <div class="right">
                                        @ko.Html.DropDownList(m => m.AssociatedMetadataSets, new { }, m => m.Name).Value(m => m.SelectedNameMappingMetadataSet)
                                        @ko.Html.Button("Update", "UpdateMapping", "EntityTypes", new { }, new { }).Enable(m => m.SelectedNameMappingMetadataSet != null && m.SelectedNameMappingMetadataSet.Name != "")
                                    </div>
                                </div>
                                <div class="bs">
                                    <div class="inner">
                                        <ul class="form form-custom">
                                            <li>
                                                <label class="control-label col-md-2">Metadata Set</label>
                                                <div class="input">
                                                    @using (var mapping = ko.With(m => m.NameMapping))
                                                    {
                                                        @ko.Html.Span(m => mapping.Model.MetadataSet)
                                                    }
                                                </div>
                                            </li>
                                            <li>
                                                <label class="control-label col-md-2">Field</label>
                                                <div class="input">
                                                    @using (var mapping = ko.With(m => m.NameMapping))
                                                    {
                                                        @ko.Html.Span(m => mapping.Model.Field)
                                                    }
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="fields-container">
                            <div class="box">
                                <div class="title">
                                    Description Mapping
                                    <div class="right">
                                        @ko.Html.DropDownList(m => m.AssociatedMetadataSets, new { }, m => m.Name).Value(m => m.SelectedDescriptionMappingMetadataSet)
                                        @ko.Html.Button("Update", "UpdateMapping", "EntityTypes", new { }, new { }).Enable(m => m.SelectedDescriptionMappingMetadataSet != null && m.SelectedDescriptionMappingMetadataSet.Name != "")
                                    </div>
                                </div>
                                <div class="bs">
                                    <div class="inner">
                                        <ul class="form form-custom">
                                            <li>
                                                <label class="control-label col-md-2">Metadata Set</label>
                                                <div class="input">
                                                    @using (var mapping = ko.With(m => m.NameMapping))
                                                    {
                                                        @ko.Html.Span(m => mapping.Model.MetadataSet)
                                                    }
                                                </div>
                                            </li>
                                            <li>
                                                <label class="control-label col-md-2">Field</label>
                                                <div class="input">
                                                    @using (var mapping = ko.With(m => m.NameMapping))
                                                    {
                                                        @ko.Html.Span(m => mapping.Model.Field)
                                                    }
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>*@


        </div>
    }
</div>
@ko.Apply(Model, context)
