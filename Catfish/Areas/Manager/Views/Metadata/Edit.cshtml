@model Catfish.Areas.Manager.Models.ViewModels.FormBuilderViewModel
@using Catfish.Areas.Manager.Models.ViewModels

@{ ViewBag.Title = ViewBag.Id > 0 ? "Edit Metadata Set Definition" : "Create Metadata Set Definition"; }

@section HEAD
{
    <script type="text/javascript" src="~/Scripts/knockout-3.1.0.js"></script>
    <script type="text/javascript" src="~/Scripts/knockout.mapping-latest.js"></script>
    <script type="text/javascript" src="~/Scripts/perpetuum.knockout.js"></script>
    <script type="text/javascript" src="~/Scripts/attachment.js"></script>
}

@section Toolbar {
    @Html.Partial("Partial/koEditToolbar", Model, new ViewDataDictionary() { { "saveButtonFunctionCall", "saveMetadataset" } })
}

@Html.Partial("Partial/FormBuilder", Model, new ViewDataDictionary() { { "controller", "metadata" }, { "action", "save" } })

<script type="text/javascript">
    function saveMetadataset() {
        var data = {
            vm: getFormBuilderContext()
        };
        data = ko.toJS(data);

        var pageForm = getFormBuilderForm();
        var xhr = new XMLHttpRequest();

        xhr.open("post", pageForm.attr("action"), )

        var form = document.createElement("form");
        form.setAttribute("method", "POST");
        form.setAttribute("action", pageForm.attr("action"), true);
        xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');

        xhr.onload = function (result) {
            deleteFormBuilderContext();
            document.open("text/html", "replace");
            document.write(xhr.response);
            document.close();
        }

        xhr.send(JSON.stringify(data));
    }
</script>