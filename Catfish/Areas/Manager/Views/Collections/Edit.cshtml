@model Catfish.Core.Models.Collection
@using PerpetuumSoft.Knockout
@using Catfish.Areas.Manager.Models.ViewModels

 @*@model Catfish.Areas.Manager.Models.EntityAssociationViewModel*@

@{  ViewBag.Title = Model.Id > 0 ? "Edit Collection" : "Create Collection"; }

@section HEAD
{
<script type="text/javascript" src="~/Scripts/knockout-3.1.0.js"></script>
<script type="text/javascript" src="~/Scripts/knockout.mapping-latest.js"></script>
<script type="text/javascript" src="~/Scripts/perpetuum.knockout.js"></script>
    <link rel="stylesheet" type="text/css" href="~/Content/Css/catfish.css">
    <script src="/node_modules/requirejs/require.js"></script>
    <script type="text/javascript" src="/built/require-config.js"></script>
    <script>
            require(["/Built/Forms/ItemForm.js"])
    </script>

<script type="text/javascript" src="~/Scripts/knockout-3.1.0.js"></script>
<script type="text/javascript" src="~/Scripts/knockout.mapping-latest.js"></script>
<script type="text/javascript" src="~/Scripts/perpetuum.knockout.js"></script>
}

@section Toolbar {
    @Html.Partial("Partial/EditToolbar")
}

@ViewBag.Status
<br />

@using (Html.BeginForm()) {

    @Html.HiddenFor(m => m.Id)
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    //for model binding
    @Html.Hidden("ModelType", Model.GetType().AssemblyQualifiedName, new Dictionary<string, object>()
    {
       {"class", "model-type"}
    })

    @Html.HiddenFor(m=>m.EntityTypeId)


    @* Rendering the metadata sets through the Entity.cshtml shared editor template *@
    @Html.EditorFor(m => m, "Entity")


    <div id="child-items">
        <h3>Child Items</h3>
        @*  @Html.DropDownList("parentCollection",(IEnumerable<SelectListItem>)ViewBag.Collections, "No Parent Collection")*@

        Use Knockout MVC to render the ViewBag.ChildItems object.<br />
        - hidden field for Active entity id<br />
        - one list for LinkedEntities array<br />
        - one list for AllEntities array<br />
        - an Add button => calls CollectionController.AddItems method ==> this method should add the selected items to the LinkedEntities array and return the updated view model<br />
        - a Remove buttonn => calls CollectionController.RemoveItems method ==> xxxxx<br />
        - selecting entities from either list should put them to the SelectedList array.<br />

        @{ var ChildItems = ViewBag.ChildItems as EntityAssociationViewModel; }
        @Html.EditorFor(m=>ChildItems)

    </div>

}


