@page
@model Catfish.Web.Pages.LoginModel
@inject CatfishExtensions.Helpers.ICatfishAppConfiguration _catfishAppConfig;
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor _httpContextAccessor
@{
    ViewBag.Title = "Login";
    bool allowGoogleLogin = _catfishAppConfig.IsAllowGoogleLogin();
    string DeniedMessage = _catfishAppConfig.GetUnauthorizedLoginMessage();
    bool enabledLocalLogin = _catfishAppConfig.GetEnabledLocalLogin();
    string externalLoginDivClass = enabledLocalLogin ? "col-md" : "col-md-12";

    Layout = ".\\_Layout";
}
<div class="container">
    <div class="row">
        @if (TempData["SuccessMessage"] != null && TempData["SuccessMessage"].ToString().Length > 0)
        {
            <div class="alert alert-success">
                @TempData["SuccessMessage"]
            </div>
        }
        <article class="col-md-6">

            @if (enabledLocalLogin)
            {
                <h2>Local Account Login</h2>
                <hr />
                <div class="row">
                    <div class="col-sm-6">
                        <form method="post">
                            @Html.AntiForgeryToken()
                            <div class="form-group">
                                <label>User name</label>
                                @Html.TextBoxFor(m => m.Username, null, new { @class = "form-control" })
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                @Html.PasswordFor(m => m.Password, new { @class = "form-control" })
                            </div>
                            <button class="btn btn-success">Login</button>
                        </form>
                        <div style="margin-top:20px;">
                            <a href="./forgotPassword">Forgot Password?</a>
                        </div>
                        <div style="margin-bottom:20px;">
                            <a href="./changepassword">Change my password</a>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                        {
                            <div class="alert alert-danger">
                                @Model.ErrorMessage
                            </div>
                        }
                    </div>

                </div>
            }
        </article>
        @Html.AntiForgeryToken()
        @if (allowGoogleLogin)
        {<article class="@externalLoginDivClass">
                <div class="grid_6 box login">
                    <div id="socialLoginDiv">
                        <h2>External Login </h2>
                        <hr />
                        <form asp-page-handler="externalLogin" method="post" asp-route-returnUrl="@Model.GetReturnUrl()">
                            @foreach (var provider in Model.ExternalLogins)
                            {
                                <input type="submit" class=" btn-primary goggleLoginBtn fa fa-google btn" value="@provider.Name" title="Login using your @provider.DisplayName account" />
                            }
                        </form>

                    </div>
                </div>
                <div class="alert alert-warning alert-dismissible allowDomain" style="visibility: hidden; text-align:center;">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    <strong>Warning!</strong> @DeniedMessage
                </div>
            </article>
        }
    </div>
</div>
